<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>OSX: switch font size when an external display is attached - Daniel's blog</title><meta name=Description content="This is my cool site"><meta property="og:title" content="OSX: switch font size when an external display is attached"><meta property="og:description" content="How to change font size in Emacs and iTerm2 when an external display is attached."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.spatof.org/posts/2016/07/osx-switch-font-size-when-an-external-display-is-attached/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-07-31T00:00:00+00:00"><meta property="article:modified_time" content="2016-07-31T00:00:00+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="OSX: switch font size when an external display is attached"><meta name=twitter:description content="How to change font size in Emacs and iTerm2 when an external display is attached."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.spatof.org/posts/2016/07/osx-switch-font-size-when-an-external-display-is-attached/><link rel=prev href=https://blog.spatof.org/posts/2016/07/extracting-values-from-an-arbitrary-json-data-structure/><link rel=next href=https://blog.spatof.org/posts/2018/02/into-the-breach-on-os-x-with-wine/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"OSX: switch font size when an external display is attached","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.spatof.org\/posts\/2016\/07\/osx-switch-font-size-when-an-external-display-is-attached\/"},"genre":"posts","keywords":"macOS, hammerspoon, emacs, iterm2","wordcount":544,"url":"https:\/\/blog.spatof.org\/posts\/2016\/07\/osx-switch-font-size-when-an-external-display-is-attached\/","datePublished":"2016-07-31T00:00:00+00:00","dateModified":"2016-07-31T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Daniel Kertesz"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Daniel's blog">blog.spatof.org</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/ title=About>About </a><a class=menu-item href=/youtube-links/ title="Youtube Links">Youtube Links </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Daniel's blog">blog.spatof.org</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title=About>About</a><a class=menu-item href=/youtube-links/ title="Youtube Links">Youtube Links</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><article class="page single"><h1 class="single-title animate__animated animate__flipInX">OSX: switch font size when an external display is attached</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Daniel Kertesz</a></span>&nbsp;<span class=post-category>included in <a href=/categories/tips-and-tricks/><i class="far fa-folder fa-fw" aria-hidden=true></i>Tips and Tricks</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2016-07-31>2016-07-31</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;544 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;3 minutes&nbsp;</div></div><div class=content id=content><p>When I need to work long hours outside of the office I usually set a smaller font in iTerm2 and Emacs (those are the applications
that I use most) because I don&rsquo;t have access to a large external display. Having to manually set the font in two different applications every time is a bit unhandy,
so I started looking for a solution.</p><h2 id=iterm2>iTerm2</h2><p>It turns out that iTerm2 recently introduced the <a href=https://www.iterm2.com/documentation-dynamic-profiles.html target=_blank rel="noopener noreffer">Dynamic Profiles</a> feature,
which allows you to store your configuration profile on the filesystem and have iTerm2 pick up all the changes immediately. That&rsquo;s a start.</p><p>I created a base profile in iTerm2 called &ldquo;Default&rdquo;, then I created two profile files, one for each font size; a profile file is a JSON file containing the profile
configuration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Profiles&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Name&#34;</span><span class=p>:</span> <span class=s2>&#34;Default+Dynamic&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Guid&#34;</span><span class=p>:</span> <span class=s2>&#34;90B59958-1F30-419B-9E4A-B52C24700CB5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Dynamic Profile Parent Name&#34;</span><span class=p>:</span> <span class=s2>&#34;Default&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Normal Font&#34;</span> <span class=p>:</span> <span class=s2>&#34;FiraMono-Regular 11&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Non Ascii Font&#34;</span> <span class=p>:</span> <span class=s2>&#34;FiraMono-Regular 11&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This profile inherits from a profile named &ldquo;Default&rdquo; and overrides the &ldquo;Normal&rdquo; and the &ldquo;Non Ascii&rdquo; font configuration options. The <code>Guid</code> field can be generated with
the <code>uuidgen</code> command, I don&rsquo;t think it does really matter. The next step is to symlink the chosen profile to <code>$HOME/Library/Application Support/iTerm2/DynamicProfiles/iTerm2_Dynamic.json</code>
and make it the default in iTerm2 (I know, I didn&rsquo;t spend much time thinking about those names), but it would be great if this task could be automated.</p><p>I recently discovered <a href=http://www.hammerspoon.org/ target=_blank rel="noopener noreffer">Hammerspoon</a>, an automation software for OS X with a Lua programming interface; Hammerspoon allows you to bind Lua callbacks to some operating
system events, to react for example when an external device is connected.</p><p>The following code set up a watcher to react when the display configuration changes (e.g. when you plug or unplug an external display) and it will overwrite the symlink to the
iTerm2 dynamic profile using the large font profile when there&rsquo;s an external display connected.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>hasExternalMonitor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=kr>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>screen</span> <span class=kr>in</span> <span class=n>pairs</span><span class=p>(</span><span class=n>hs.screen</span><span class=p>.</span><span class=n>allScreens</span><span class=p>())</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>      <span class=kr>if</span> <span class=n>screen</span><span class=p>:</span><span class=n>name</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&#34;Thunderbolt Display&#34;</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>         <span class=kr>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>      <span class=kr>end</span>
</span></span><span class=line><span class=cl>   <span class=kr>end</span>
</span></span><span class=line><span class=cl>   <span class=kr>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Switch dynamic profile in iTerm2</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>setIterm2Profile</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>hs.execute</span><span class=p>(</span><span class=s2>&#34;ln -sf $HOME/Preferences/iTerm2/&#34;</span> <span class=o>..</span> <span class=n>filename</span> <span class=o>..</span> <span class=s2>&#34; </span><span class=se>\&#34;</span><span class=s2>$HOME/Library/Application Support/iTerm2/DynamicProfiles/iTerm2_Dynamic.json</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>displayWatcherCallback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=kr>if</span> <span class=n>hasExternalMonitor</span><span class=p>()</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>      <span class=n>setIterm2Profile</span><span class=p>(</span><span class=s2>&#34;iTerm2_Dynamic_12.json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=kr>else</span>
</span></span><span class=line><span class=cl>      <span class=n>setIterm2Profile</span><span class=p>(</span><span class=s2>&#34;iTerm2_Dynamic_11.json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>monitorWatcher</span> <span class=o>=</span> <span class=n>hs.screen</span><span class=p>.</span><span class=n>watcher.new</span><span class=p>(</span><span class=n>displayWatcherCallback</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>monitorWatcher</span><span class=p>:</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></div><p>This code expect that your store your dynamic profile files in <code>$HOME/Preferences/iTerm2/</code> and call them <code>iTerm2_Dynamic_11.json</code> and <code>iTerm2_Dynamic_12.json</code>.</p><h2 id=emacs>Emacs</h2><p>To achieve the same goal in Emacs I wrote some an​ elisp function to detect if there&rsquo;s an external display attached and change the font accordingly; then it&rsquo;s all a matter
of running <code>(server-start)</code> and calling this function from <code>displayWatcherCallback()</code> in Hammerspoon.</p><p>Hammerspoon code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>tellEmacsToChangeFont</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=n>hs.execute</span><span class=p>(</span><span class=s2>&#34;/usr/local/bin/emacsclient -e &#39;(set-the-right-font)&#39;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>displayWatcherCallback</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=n>tellEmacsToChangeFont</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=kr>if</span> <span class=n>hasExternalMonitor</span><span class=p>()</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>      <span class=n>setIterm2Profile</span><span class=p>(</span><span class=s2>&#34;iTerm2_Dynamic_12.json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=kr>else</span>
</span></span><span class=line><span class=cl>      <span class=n>setIterm2Profile</span><span class=p>(</span><span class=s2>&#34;iTerm2_Dynamic_11.json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><p>Emacs code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lisp data-lang=lisp><span class=line><span class=cl><span class=p>(</span><span class=nb>defun</span> <span class=nv>set-the-right-font</span> <span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;Set the right font according to the connected displays&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nv>interactive</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>let</span> <span class=p>((</span><span class=nv>monitors</span> <span class=p>(</span><span class=nv>shell-command-to-string</span> <span class=s>&#34;system_profiler  SPDisplaysDataType | egrep &#39;^ {8}[^ ]&#39; | sed -e &#39;s/^ *//&#39; -e &#39;s/:$//&#39;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nv>hasExternal</span> <span class=no>nil</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nb>dolist</span> <span class=p>(</span><span class=nv>monitor</span> <span class=p>(</span><span class=nv>split-string</span> <span class=nv>monitors</span> <span class=s>&#34;\n&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>when</span> <span class=p>(</span><span class=nf>string=</span> <span class=nv>monitor</span> <span class=s>&#34;Thunderbolt Display&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=k>setq</span> <span class=nv>hasExternal</span> <span class=no>t</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>if</span> <span class=nv>hasExternal</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nv>set-default-font</span> <span class=s>&#34;Fira Mono-12&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nv>set-default-font</span> <span class=s>&#34;Fira Mono-11&#34;</span><span class=p>))))</span>
</span></span></code></pre></div><p>I have to say that I&rsquo;m surprised that everything seems to be working well.</p><h2 id=notes>Notes</h2><ul><li>I think dynamic profiles was introduced in iTerm2 3.x.</li><li>By &ldquo;Emacs&rdquo; I mean the OS X port of Emacs running in GUI mode, installed with Homebrew.</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2016-07-31</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://blog.spatof.org/posts/2016/07/osx-switch-font-size-when-an-external-display-is-attached/ data-title="OSX: switch font size when an external display is attached"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://blog.spatof.org/posts/2016/07/osx-switch-font-size-when-an-external-display-is-attached/><i class="fab fa-reddit fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/macos/>macOS</a>,&nbsp;<a href=/tags/hammerspoon/>hammerspoon</a>,&nbsp;<a href=/tags/emacs/>emacs</a>,&nbsp;<a href=/tags/iterm2/>iterm2</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2016/07/extracting-values-from-an-arbitrary-json-data-structure/ class=prev rel=prev title="Extracting values from an arbitrary JSON data structure"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Extracting values from an arbitrary JSON data structure</a>
<a href=/posts/2018/02/into-the-breach-on-os-x-with-wine/ class=next rel=next title="Into the Breach on OS X with Wine">Into the Breach on OS X with Wine<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><script type=text/javascript src=https://storage.ko-fi.com/cdn/widget/Widget_2.js></script><script type=text/javascript>kofiwidget2.init("Support Me on Ko-fi","#29abe0","U6U07489O"),kofiwidget2.draw()</script></div><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2013 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Daniel Kertesz</a></span>&nbsp;|&nbsp;<span class=license><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png></a><br>This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:500},comment:{},search:{highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>